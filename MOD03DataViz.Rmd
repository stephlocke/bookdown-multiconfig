---
title: "Data visualisation basics"
author: "Locke Data"
site: bookdown::bookdown_site
documentclass: book
output:
  bookdown::gitbook: default
  bookdown::pdf_book: default
---


# Locke Data {-}
Locke Data is a consultancy that helps people and organisations get started with data science. We offer training, advice, and technical leadership to make sure things go more smoothly.

Find out more about us at [itsalocke.com](https://itsalocke.com). 




<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.

```{r include=FALSE}
library(dplyr)
library(RColorBrewer)
library(ggplot2)
library(plotly)
library(cowplot)

theme_set(theme_grey())
```

# Data viz options
## Data viz in R
So many options!

- base R
- ggplot2
- ggraph
- leaflet

# ggplot2 fundamentals
## The keywords
Term | Explanation | Example(s)
------------- | ------------- | -------------
**plot** | A plot using the grammar of graphics | `ggplot()`
**aes**thetics | attributes of the chart | colour, x, y
mapping | relating a column in your data to an aesthetic 
**stat**istical transformation | a translation of the raw data into a refined summary | `stat_density()`
**geom**etry | the display of aesthetics | `geom_line()`, `geom_bar()`
**scale** | the range of values | axes, legends
**coord**inate system|  how geometries get laid out | `coord_flip()`
**facet** | a means of subsetting the chart | `facet_grid()`
**theme** | display properties | `theme_minimal()`

## The value of ggplot
```{r}
library(ggplot2)
library(datasauRus)

ggplot(datasaurus_dozen, aes(x=x, y=y))+
  geom_point()
```

## The value of ggplot
```{r}
p<-ggplot(datasaurus_dozen, aes(x=x, y=y))+
  geom_point() +
  facet_wrap(~dataset)+
  theme_void()
p
```

## The value of ggplot
```{r}
p %+% datasauRus::simpsons_paradox
```

## Common aesthetics

- x
- y
- group
- colour
- size
- fill


## Basics
```{r}
ggplot(data=datasaurus_dozen, aes(x,y)) + 
  geom_point()
```

## Basics
```{r}
ggplot(data=datasaurus_dozen, 
       aes(x,y, colour=dataset, size=x)) + 
  geom_point(alpha=.5)
```

## Basics
```{r}
ggplot(data=simpsons_paradox, 
       aes(x,y, colour=dataset, shape=dataset)) + 
  geom_point()
```

# ggplot2 common charts
## Scatter plots
Scatter plots are built with `geom_point()`

```{r}
ggplot(data=simpsons_paradox, aes(x=x,y=y)) + 
  geom_point()
```

## Common scatter plots - size
```{r}
ggplot(data=simpsons_paradox, aes(x=x,y=y, size=dataset)) + 
  geom_point()
```

## Common scatter plots - colour
```{r}
ggplot(data=simpsons_paradox, aes(x=x,y=y, colour=dataset)) + 
  geom_point()
```


## Common scatter plots - avoid overplotting
```{r}
ggplot(data=simpsons_paradox, aes(x=x,y=y, colour=dataset)) + 
  geom_point(alpha=.5)
```

## Common scatter plots - avoid overplotting
```{r}
ggplot(data=simpsons_paradox, aes(x=x,y=y, colour=dataset)) + 
  geom_jitter(width=5)
```

## Exercise
1. Plot the iris dataset with Sepal.Width and Sepal.Length as the axes
2. Try out some of the aesthetics used to see if there's any clusters in the data
3. Try out some of the aesthetics used to see if there's any overplotting issues

## Bar charts - counts
Show frequency values using the `geom_bar()` function.
```{r}
library(dplyr)
set.seed(777)
datasaurus_dozen %>% 
  sample_frac(.75) ->
  dd_sample

ggplot(data=dd_sample, aes(x=dataset))+
  geom_bar()
```

## Bar charts - values
```{r}
library(dplyr)
dd_sample %>% 
  group_by(dataset) %>% 
  summarise(avg=mean(x)) %>% 
  ggplot(aes(x=dataset, y=avg)) +
    geom_col()
```

## Bar charts - colours
```{r}
ggplot(data=dd_sample, aes(x=dataset, fill=dataset))+
  geom_bar()
```

## Bar charts - bar customisation
```{r}
ggplot(data=dd_sample, aes(x=dataset, fill=dataset))+
  geom_bar(width = .5)+
  coord_flip()
```


## Exercises
1. Write your own version of `dd_sample`
2. Produce a bar chart showing the max `y` value for each dataset

## Line charts
```{r}
ggplot(data=simpsons_paradox, aes(x=x, y=y, group=dataset, colour= dataset))+
  geom_line()
```

## Line charts - customising
```{r}
ggplot(data=simpsons_paradox, aes(x=x, y=y, group=dataset, colour= dataset))+
  geom_line(size=2, lineend = "round", linetype = 2)
```

## density charts
```{r}
ggplot(data=dd_sample, aes(x=x))+
  geom_histogram()
```
## density charts
```{r}
ggplot(data=dd_sample, aes(x=x))+
  geom_density()
```

## density charts
```{r}
ggplot(data=dd_sample, aes(x=dataset, y=y))+
  geom_violin()
```

## density charts
```{r}
ggplot(data=dd_sample, aes(x=x, y=y))+
  geom_bin2d()
```

## Exercises
1. Build a density chart of your dd_sample using `geom_density()`, use the sorts of aesthetics values we've already used to make this a density by dataset



# ggplot2 facets

## Facets
Faceting in ggplot is used to produce "small multiple" charts. These split out a chart by a feature in the data to produce many charts.

```{r echo=FALSE}
ggplot(data=datasaurus_dozen, aes(x=x,y=y))+
  geom_point()+
  facet_wrap(~dataset)
```

## Faceting by a single variable
You can facet by a single variable with `facet_wrap()`. This takes a variable name prefixed with a tilde(`~`).
```{r}
ggplot(data=datasaurus_dozen, aes(x=x,y=y))+
  geom_point()+
  facet_wrap(~dataset)
```

## Faceting by a single variable
Customise the wrapping with `nrow` or `ncol`.
```{r}
ggplot(data=datasaurus_dozen, aes(x=x,y=y))+
  geom_point()+
  facet_wrap(~dataset,nrow = 3)
```

## Faceting by multiple variables
Use `facet_grid()` to produce a small multiple for two or more variables. Variables for the row go on the LHS of the tilde and the variables for the column go on the right.
```{r}
dd_sample %>% 
  mutate(dino=dataset=="dino") %>% 
  ggplot(aes(x,y))+
  geom_point()+
  facet_grid(dino~dataset)
```

## Exercises
1. Produce a facetted scatter plot for `simpsons_paradox` split by dataset

# ggplot2 theming

## Themes
ggplot's can be themed easily with theme functions. There are many `theme_*` functions available in ggplot2 but you can also get ggthemes or create your own.

```{r echo=FALSE}
library(cowplot)
datasaurus_dozen %>% 
  filter(dataset=="dino") ->
  dino

theme_set(theme_grey())
p<-ggplot(dino,aes(x,y))+geom_point()
p_min<-p+theme_minimal()
p_void<-p+theme_void()
p_bw<-p+theme_bw()
plot_grid(p, p_min, p_void, p_bw)
```

## Titles and labels

```{r}
ggplot(datasaurus_dozen,aes(x,y, colour=dataset))+ geom_point()+
  facet_wrap(~dataset)+
  ggtitle("Datasaurus Dozen", "Every dataset has the same summary statistics")
```

## Titles and labels

```{r}
ggplot(datasaurus_dozen,aes(x,y, colour=dataset))+ geom_point()+
  facet_wrap(~dataset)+
  labs(title="Datasaurus Dozen", subtitle="Every dataset has the same summary statistics",
       x= "X coord", y= "Y coord")
```

## Managing style
```{r}
ggplot(datasaurus_dozen,aes(x,y, colour=dataset))+ geom_point()+
  facet_wrap(~dataset)+
  ggtitle("Datasaurus dataset") +
  theme(legend.position="none", text = element_text(colour="red"))
```

## Series colours
There are other colour packages out there (e.g. viridis and wesanderson)

```{r}
library(RColorBrewer)
ggplot(datasaurus_dozen[1:852,],aes(x,y, colour=dataset))+ geom_point()+
  facet_wrap(~dataset)+
  scale_color_brewer(type="qual", palette = "Dark2")
```

## Exercises
1. Using the knowledge acquired in this section, make one of your charts look good.

# Interactive ggplots

## Plotly
Plotly is an interactive charting library. It has it's own capabilities that are very extensive but we'll be focussing on using `ggplotly()`.
```{r echo=FALSE}
library(plotly)
plot_ly(z = ~volcano) %>% add_surface()
```

## ggplotly
```{r}
p<-ggplot(datasaurus_dozen,aes(x,y, colour=dataset))+ geom_point()
ggplotly(p)
```

## Plotly aesthetics
```{r}
p<-ggplot(datasaurus_dozen,aes(x,y, colour=dataset, text=paste("From the dataset", toupper(dataset))))+ 
  geom_point() +facet_wrap(~dataset)+theme_void()
ggplotly(p, tooltip = "text")
```

## Exercises
1. Construct a ggplot that displays the `anscombe` data and turn it into a plotly chart

# ggplot - stretch content

## Pipe into ggplot
You can use ggplot at the end of a dplyr pipeline to keep things tidy.
```{r}
simpsons_paradox %>% 
  group_by(dataset) %>% 
  summarise_all(mean) %>% 
  ggplot(aes(x,y))+
    geom_point() ->
  p
p
```

## ggplot2 is additive
Usingg the plus symbols you can continue adding things to a ggplot object.
```{r}
p +
  geom_point(colour="red", size=2)+
  facet_wrap(~dataset)+
  geom_point(data=simpsons_paradox)
```

## Add statistics to a plot
```{r}
ggplot(datasaurus_dozen, aes(x,y))+
  geom_point()+
  facet_wrap(~dataset, scale="free") +
  geom_abline()
```

## Add statistics to a plot
```{r}
ggplot(datasaurus_dozen, aes(x,y))+
  geom_point()+
  facet_wrap(~dataset, scale="free") +
  geom_smooth()
```

## Add labels to a plot
```{r}
ggplot(simpsons_paradox, aes(x,y, label=dataset))+
  facet_wrap(~dataset, scale="free") +
  geom_point() +
  geom_label() + 
  theme_void()
```

## Add labels to a plot
```{r}
ggplot(simpsons_paradox, aes(x,y, label=dataset, colour=dataset))+
  geom_text() + 
  theme_void()
```

## Exercises
1. Create a dataset from datasaurus_dozen just with dino the dinosaur
2. Plot dino using a scatterplot
3. Add a line geom
